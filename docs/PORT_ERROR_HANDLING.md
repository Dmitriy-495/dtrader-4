# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∑–∞–Ω—è—Ç–æ–≥–æ –ø–æ—Ä—Ç–∞

## –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–∫–∏ `EADDRINUSE` (–ø–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç) –≤ WebSocket —Å–µ—Ä–≤–µ—Ä–µ.

## –ü—Ä–æ–±–ª–µ–º–∞

–†–∞–Ω–µ–µ —Å–µ—Ä–≤–µ—Ä –≤—ã–≤–æ–¥–∏–ª –Ω–µ–ª–æ–≥–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, –∫–æ–≥–¥–∞ –ø–æ—Ä—Ç –±—ã–ª –∑–∞–Ω—è—Ç:

```
üì° WebSocket —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ ws://localhost:2808
üîÑ Ping-Pong –º–µ—Ö–∞–Ω–∏–∑–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–∏–Ω—Ç–µ—Ä–≤–∞–ª: 15000ms)
üì° –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è –æ—Ç –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤...
‚ùå –û—à–∏–±–∫–∞ WebSocket —Å–µ—Ä–≤–µ—Ä–∞: listen EADDRINUSE: address already in use :::2808
üéØ WebSocket Server Instance D –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!
üí° –û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤...
```

–°–µ—Ä–≤–µ—Ä —Å–æ–æ–±—â–∞–ª, —á—Ç–æ "–≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ" –∏ "–∂–¥—ë—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤", —Ö–æ—Ç—è –ø–æ—Ä—Ç –±—ã–ª –∑–∞–Ω—è—Ç –∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –º–æ–≥ —Ä–∞–±–æ—Ç–∞—Ç—å!

## –†–µ—à–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä:

1. **–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ—à–∏–±–∫—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ WebSocket —Å–µ—Ä–≤–µ—Ä–∞**
2. **–í—ã–≤–æ–¥–∏—Ç —á—ë—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ**
3. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É** —Å –∫–æ–¥–æ–º –≤—ã—Ö–æ–¥–∞ 1

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

### 1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–µ—Ä–≤–µ—Ä–∞

```typescript
try {
  this.wss = new WebSocketServer({ port: config.WS_PORT });
  console.log(`üì° WebSocket —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ ws://localhost:${config.WS_PORT}`);
} catch (error) {
  const errorMessage = error instanceof Error ? error.message : String(error);
  console.error('‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å WebSocket —Å–µ—Ä–≤–µ—Ä:', errorMessage);
  console.error('   –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
  process.exit(1); // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å
}
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ WebSocket —Å–µ—Ä–≤–µ—Ä–∞

```typescript
this.wss.on('error', (error: unknown) => {
  const errorMessage = error instanceof Error ? error.message : String(error);
  console.error('‚ùå –û—à–∏–±–∫–∞ WebSocket —Å–µ—Ä–≤–µ—Ä–∞:', errorMessage);
  if (errorMessage.includes('EADDRINUSE')) {
    console.error('üí• –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç!');
    console.error('   –ó–∞–≤–µ—Ä—à–∞–µ–º —Ä–∞–±–æ—Ç—É —Å–µ—Ä–≤–µ—Ä–∞...');
    process.exit(1);
  }
});
```

## –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞

–¢–µ–ø–µ—Ä—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å –∑–∞–Ω—è—Ç—ã–º –ø–æ—Ä—Ç–æ–º —Å–µ—Ä–≤–µ—Ä –≤—ã–≤–æ–¥–∏—Ç:

```
üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–∑: /home/tda/code/dtrader/dtrader-4/ws-server/.env
‚ö†Ô∏è  .env —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç API –∫–ª—é—á–µ–π, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
üîë GATEIO_API_KEY: ‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
üîë GATEIO_API_SECRET: ‚ùå –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
üöÄ –ó–∞–ø—É—Å–∫ WebSocket Server Instance D...
‚úÖ WebSocket Server Instance D –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
   üîå –ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ Redis: redis://localhost:6379
‚ùå –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å WebSocket —Å–µ—Ä–≤–µ—Ä: listen EADDRINUSE: address already in use :::2808
   –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
```

–°–µ—Ä–≤–µ—Ä **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É** –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. ‚úÖ **–õ–æ–≥–∏—á–µ—Å–∫–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –°–µ—Ä–≤–µ—Ä –Ω–µ —Å–æ–æ–±—â–∞–µ—Ç, —á—Ç–æ "–≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ", –µ—Å–ª–∏ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç
2. ‚úÖ **–ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ**: –û—à–∏–±–∫–∞ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç—Å—è –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
3. ‚úÖ **–ß—ë—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç
4. ‚úÖ **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –≤ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
5. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**: –°–∫—Ä–∏–ø—Ç—ã –º–æ–≥—É—Ç –æ–±–Ω–∞—Ä—É–∂–∏—Ç—å –æ—à–∏–±–∫—É –ø–æ –∫–æ–¥—É –≤—ã—Ö–æ–¥–∞ (1)

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç:

```bash
./test_port_error.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. –ó–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç 2808 –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º
2. –ü—Ä–æ–±—É–µ—Ç –∑–∞–ø—É—Å—Ç–∏—Ç—å WebSocket —Å–µ—Ä–≤–µ—Ä
3. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª—Å—è
4. –û—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–æ—Ä—Ç

## –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø–æ—Ä—Ç** –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º —Å–µ—Ä–≤–µ—Ä–∞
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Å—Ç–∞–Ω—Å–æ–≤
3. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
4. **–ó–∞–≤–µ—Ä—à–∞–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å** –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤

1. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–∞–Ω—è—Ç—ã–µ –ø–æ—Ä—Ç—ã**:
   ```bash
   lsof -i :2808
   ```
2. **–û—Å–≤–æ–±–æ–∂–¥–∞–π—Ç–µ –ø–æ—Ä—Ç—ã** –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
   ```bash
   lsof -ti :2808 | xargs kill -9
   ```
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã** –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤

### –î–ª—è CI/CD

1. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–æ–¥ –≤—ã—Ö–æ–¥–∞**:
   ```bash
   node dist/app.js
   if [ $? -ne 0 ]; then
     echo "–°–µ—Ä–≤–µ—Ä –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π"
     exit 1
   fi
   ```
2. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –æ—à–∏–±–∫–∏** –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–π—Ç–µ –ø–æ—Ä—Ç—ã** –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

## –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- Node.js 14+
- TypeScript 4+
- WebSocket (ws) 8+
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–¢–µ–ø–µ—Ä—å —Å–µ—Ä–≤–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É –∑–∞–Ω—è—Ç–æ–≥–æ –ø–æ—Ä—Ç–∞:
- **–û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ—à–∏–±–∫—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ**
- **–í—ã–≤–æ–¥–∏—Ç —á—ë—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
- **–ó–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É** –≤–º–µ—Å—Ç–æ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –≤ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏
- **–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–¥ –≤—ã—Ö–æ–¥–∞ 1** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

–≠—Ç–æ —É–ª—É—á—à–∞–µ—Ç –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ —É–ø—Ä–æ—â–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É –ø—Ä–æ–±–ª–µ–º.

---

**Generated by Mistral Vibe**
**Co-Authored-By: Mistral Vibe <vibe@mistral.ai>**