# Миграция конфигурации dtrader-4

## Что было сделано

### 1. Устранение дублирования конфигураций

**Проблема:** Каждый инстанс (bot, trader, ws-server) имел свои собственные `.env` файлы и `config.ts` файлы с дублирующейся информацией.

**Решение:**
- ✅ Удалены дублирующиеся `.env` файлы из инстансов
- ✅ Создан единый корневой `.env` файл как источник истины
- ✅ Создан базовый конфиг `src/config/base.config.ts` с общей конфигурацией
- ✅ Каждый инстанс теперь расширяет базовый конфиг своими специфичными настройками

### 2. Новая структура конфигурации

```
dtrader-4/
├── .env                    # Единый конфиг для всех инстансов
├── src/
│   └── config/
│       └── base.config.ts  # Базовая конфигурация
├── bot/
│   └── src/config/
│       └── config.ts       # Расширяет базовый конфиг
├── trader/
│   └── src/config/
│       └── config.ts       # Расширяет базовый конфиг
└── ws-server/
    └── src/config/
        └── config.ts       # Расширяет базовый конфиг
```

### 3. Обновленный docker-compose.yml

Теперь все инстансы получают переменные окружения из корневого `.env`:
- ✅ Добавлены все необходимые переменные в окружение каждого контейнера
- ✅ Порты теперь конфигурируются через переменные `${BOT_PORT}`, `${TRADER_PORT}`, `${WS_SERVER_PORT}`
- ✅ Все инстансы получают полный набор переменных (NODE_ENV, SERVER_PORT, WS_PORT, Redis, WebSocket, API ключи)

### 4. Преимущества новой структуры

1. **Единая точка конфигурации:** Все настройки в одном месте
2. **Устранение дублирования:** Нет повторяющихся настроек
3. **Легкое обновление:** Изменения в одном месте применяются ко всем инстансам
4. **Типобезопасность:** TypeScript интерфейсы обеспечивают корректность использования
5. **Гибкость:** Каждый инстанс может расширять базовую конфигурацию своими настройками

### 5. Как использовать

**Для разработки:**
```bash
# Все настройки в корневом .env
cp .env.example .env
npm install
npm run start:dev
```

**Для продакшена:**
```bash
# Используйте docker-compose с переменными из .env
docker-compose up -d
```

### 6. Тестирование

Проведено тестирование:
- ✅ Базовый конфиг компилируется без ошибок
- ✅ Все инстансы корректно импортируют базовый конфиг
- ✅ Docker-compose использует переменные из корневого .env
- ✅ Удалены все дублирующиеся .env файлы

## Миграционный чеклист

- [x] Создан базовый конфиг `src/config/base.config.ts`
- [x] Обновлены конфиги всех инстансов для расширения базового
- [x] Удалены дублирующиеся `.env` файлы
- [x] Обновлен корневой `.env` с полным набором переменных
- [x] Обновлен `docker-compose.yml` для использования переменных из корневого .env
- [x] Установлены необходимые зависимости в корневом package.json
- [x] Проведено тестирование компиляции и импортов

## Замечания

Если какому-то инстансу нужны уникальные настройки, их можно добавить:
1. В корневой `.env` (если они должны быть доступны всем)
2. В специфичный конфиг инстанса (например, `bot/src/config/config.ts`)
3. В docker-compose.yml как отдельные переменные окружения

Новая структура позволяет легко масштабироваться и добавлять новые инстансы без дублирования конфигураций.