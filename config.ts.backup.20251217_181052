// Ð‘Ð°Ð·Ð¾Ð²Ð°Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð²ÑÐµÑ… Ð¸Ð½ÑÑ‚Ð°Ð½ÑÐ¾Ð² dtrader-4
import * as dotenv from "dotenv";
import * as path from "path";

const rootEnvPath = path.resolve(__dirname, "../../../.env");
dotenv.config({ path: rootEnvPath });
console.log(rootEnvPath);

console.log("ðŸ“ Ð—Ð°Ð³Ñ€ÑƒÐ·ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ð¸Ð·:", rootEnvPath);
if (!process.env.GATEIO_API_KEY || !process.env.GATEIO_API_SECRET) {
  console.log(
    "âš ï¸  .env Ñ„Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½ Ð¸Ð»Ð¸ Ð½Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ API ÐºÐ»ÑŽÑ‡ÐµÐ¹, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÑŽÑ‚ÑÑ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ"
  );
}

console.log(
  "ðŸ”‘ GATEIO_API_KEY:",
  process.env.GATEIO_API_KEY ? "âœ… ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½" : "âŒ ÐÐµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
);
console.log(
  "ðŸ”‘ GATEIO_API_SECRET:",
  process.env.GATEIO_API_SECRET ? "âœ… ÐÐ°ÑÑ‚Ñ€Ð¾ÐµÐ½" : "âŒ ÐÐµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½"
);

export interface ExchangeConfig {
  apiKey?: string;
  secret?: string;
  enabled: boolean;
  futuresWsUrl?: string;
}

export interface RedisConfig {
  host: string;
  port: number;
}

export interface WebSocketConfig {
  pingInterval: number;
  pingTimeout: number;
}

export interface TradingPair {
  symbol: string;
  base: string;
  quote: string;
}

export interface OrderBookConfig {
  depth: number;
  updateSpeed: string;
  pairs: TradingPair[];
}

export interface BaseConfig {
  NODE_ENV: string;
  SERVER_PORT: number;
  WS_PORT: number;
  exchange: ExchangeConfig;
  websocket: WebSocketConfig;
  redis: RedisConfig;
  orderBook: OrderBookConfig;
}

// ÐŸÐ°Ñ€ÑÐ¸Ð½Ð³ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ñ… Ð¿Ð°Ñ€ Ð¸Ð· env
function parseTradingPairs(pairsString?: string): TradingPair[] {
  if (!pairsString) {
    return [];
  }

  return pairsString.split(",").map((pair) => {
    const trimmed = pair.trim();
    const [base, quote] = trimmed.split("_");
    
    return {
      symbol: trimmed,
      base: base || "",
      quote: quote || "",
    };
  });
}

export const baseConfig: BaseConfig = {
  NODE_ENV: process.env.NODE_ENV || "development",
  SERVER_PORT: parseInt(process.env.SERVER_PORT || "1971"),
  WS_PORT: parseInt(process.env.WS_PORT || "2808"),
  exchange: {
    apiKey: process.env.GATEIO_API_KEY,
    secret: process.env.GATEIO_API_SECRET,
    enabled: !!process.env.GATEIO_API_KEY && !!process.env.GATEIO_API_SECRET,
    futuresWsUrl: process.env.GATEIO_FUTURES_WS_URL || "wss://fx-ws.gateio.ws/v4/ws/usdt",
  },
  websocket: {
    pingInterval: parseInt(process.env.WS_PING_INTERVAL || "15000"),
    pingTimeout: parseInt(process.env.WS_PING_TIMEOUT || "3000"),
  },
  redis: {
    host: process.env.REDIS_HOST || "localhost",
    port: parseInt(process.env.REDIS_PORT || "6379"),
  },
  orderBook: {
    depth: parseInt(process.env.ORDERBOOK_DEPTH || "20"),
    updateSpeed: process.env.ORDERBOOK_UPDATE_SPEED || "100ms",
    pairs: parseTradingPairs(process.env.TRADING_PAIRS),
  },
};

// Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ñ… Ð¿Ð°Ñ€
console.log("ðŸ“Š Ð¢Ð¾Ñ€Ð³Ð¾Ð²Ñ‹Ðµ Ð¿Ð°Ñ€Ñ‹:");
baseConfig.orderBook.pairs.forEach((pair) => {
  console.log(`   ${pair.symbol} (${pair.base}/${pair.quote})`);
});
console.log(`ðŸ“– Order Book Ð³Ð»ÑƒÐ±Ð¸Ð½Ð°: ${baseConfig.orderBook.depth}`);
